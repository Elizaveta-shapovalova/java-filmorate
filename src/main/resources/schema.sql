CREATE TABLE IF NOT EXISTS users (
    id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email varchar UNIQUE NOT NULL,
    login varchar UNIQUE NOT NULL,
    name varchar,
    birthday date
);

CREATE TABLE IF NOT EXISTS follow (
    user_id integer NOT NULL,
    friend_id integer NOT NULL,
    PRIMARY KEY (friend_id, user_id)
);

CREATE TABLE IF NOT EXISTS genre (
    id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name varchar NOT NULL
);

CREATE TABLE IF NOT EXISTS MPA (
    id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name varchar NOT NULL
);

CREATE TABLE IF NOT EXISTS movie (
    id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name varchar NOT NULL,
    description varchar(200),
    release_date date NOT NULL,
    duration integer NOT NULL,
    rate integer NOT NULL,
    mpa_id integer REFERENCES MPA (id)
);

CREATE TABLE IF NOT EXISTS film_genre (
    film_id integer NOT NULL,
    genre_id integer NOT NULL,
    CONSTRAINT IF NOT EXISTS "film_id_foreign" FOREIGN KEY (film_id) REFERENCES movie (id),
    CONSTRAINT IF NOT EXISTS "genre_id_foreign" FOREIGN KEY (genre_id) REFERENCES genre (id),
    PRIMARY KEY (film_id, genre_id)
);


CREATE TABLE IF NOT EXISTS likes (
    film_id integer NOT NULL,
    user_id integer NOT NULL,
    PRIMARY KEY (film_id, user_id)
);
